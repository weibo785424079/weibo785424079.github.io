---
title: 执行上下文&变量对象
date: 2019-11-12 14:37:14
tags:
---
## 变量提升

* 函数声明优先变量声明
* 函数声明覆盖函数参数
* 变量声明与函数参数共享声明（变量与函数参数重名事var忽略，let const报错）

## 执行上下文栈

### 创建执行上下文的场景
1. 全局代码 -> 全局上下文
2. 函数 -> 函数上下文
3. eval ,new Function -> 动态上下文

以栈的形式，先进后出，全局上下文为栈底.

## 变量对象（VO）活动过对象（AO）

* VO(变量对象), 也就是 variable object, 创建执行上下文时与之关联的会有一个变量对象，该上下文中的所有变量和函数全都保存在这个对象中。
* AO(活动对象), 也就是``activation object`,进入到一个执行上下文时，此执行上下文中的变量和函数都可以被访问到，可以理解为被激活了。

### 执行过程
1. 创建阶段
   1. 创建变量、参数、函数、arguments对象
   2. 建立作用域链
   3. 确定this的值
2. 执行阶段
   1. 变量复制，函数引用，执行代码

在创建阶段，也就是代码执行之前
此时的变量对象包括(如下顺序初始化):
1. 函数的所有形参(仅在函数上下文): 没有实参, 属性值为undefined;
2. 函数声明：如果变量对象已经存在相同名称的属性，则完全替换这个属性;
3. 变量声明：如果变量名称跟已经声明的形参或函数相同，则变量声明不会干扰已经存在的这类属性

#### 执行之前
```js
AO = {
	arguments: {
		0: 1,
		length: 1
	},
	a: 1,
	b: undefined,
	c: reference to function c() {},
	d: undefined
}
```


#### 代码执行
```js
AO = {
  arguments: {
  0: 1,
  length: 1
  },
  a: 1,
  b: 20,
  c: reference to function c() {},
  d: reference to function d() {}
}
```
在此阶段, 前面的变量对象中的值就会被赋值了, 此时变量对象处于激活状态.